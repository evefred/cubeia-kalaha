<?xml version="1.0" encoding="utf-8"?>

<!-- 
 * Copyright (C) 2009 Cubeia Ltd <info@cubeia.com>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as
 * published by the Free Software Foundation, either version 3 of the
 * License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->	

<mx:TitleWindow xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute" width="308" height="206" title="Login" borderColor="#AD3333" color="#FFFFFF" fontSize="12" showCloseButton="false" alpha="1.0" backgroundAlpha="0.0" borderAlpha="1" backgroundColor="#540808" defaultButton="{loginButton}" creationComplete="setupLoginHandler()" shadowDirection="right">

	<mx:Script>
		<![CDATA[
			import mx.managers.FocusManager;
			import mx.managers.PopUpManager;
			import com.cubeia.firebase.events.LoginResponseEvent;
			
			[Bindable]
			private var _loginPending:Boolean = false;
			
			private function setupLoginHandler():void
			{
				// add listener for login events
				KalahaRealClient.firebaseClient.addEventListener(LoginResponseEvent.LOGIN, onLoginResponse);
			}
			
			private function onLoginResponse(loginReponseEvent:LoginResponseEvent):void
			{
				// we have received a login response, remove ourself
				KalahaRealClient.firebaseClient.removeEventListener(LoginResponseEvent.LOGIN, onLoginResponse);
				_loginPending = false;								
				PopUpManager.removePopUp(this);
			}
		
			private function onLoginClicked():void
			{
				// protect multiple clicks
				_loginPending = true;
				// login to game server
				KalahaRealClient.firebaseClient.login(username.text, password.text);		
			}
			
			private function setUsernameFocus():void
			{
				focusManager.setFocus(username);
			}
		]]>
	</mx:Script>

	<mx:Label x="8" y="10" text="Username:"/>
	<mx:Label x="10" y="63" text="Password:"/>
	<mx:TextInput x="10" y="30" id="username" width="268" tabIndex="1" color="#333333" themeColor="#AD3333" creationComplete="setUsernameFocus()"/>
	<mx:TextInput x="10" y="83" id="password" width="268" displayAsPassword="true" tabIndex="2" color="#333333" themeColor="#AD3333"/>
	<mx:Button x="113" y="124" label="Login" click="onLoginClicked()" id="loginButton" enabled="{username.text.length > 0 &amp;&amp; password.text.length > 0 &amp;&amp; _loginPending == false}" tabIndex="3" themeColor="#AD3333" color="#FFFFFF" fillAlphas="[1.0, 1.0]" fillColors="[#AD3333, #460A0A]"/>

</mx:TitleWindow>
