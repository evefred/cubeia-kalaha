<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>LobbyWindow.mxml</title>
<link rel="stylesheet" type="text/css" href="../SourceStyles.css"/>
</head>

<body><pre><span class="MXMLProcessing_Instruction">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>

<span class="MXMLComment">&lt;!--</span><span class="MXMLComment"> 
 * Copyright (C) 2009 Cubeia Ltd &lt;info@cubeia.com&gt;
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as
 * published by the Free Software Foundation, either version 3 of the
 * License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
</span><span class="MXMLComment">--&gt;</span>    

<span class="MXMLComponent_Tag">&lt;mx:Canvas</span><span class="MXMLDefault_Text"> xmlns:mx=&quot;</span><span class="MXMLString">http://www.adobe.com/2006/mxml</span><span class="MXMLDefault_Text">&quot; width=&quot;</span><span class="MXMLString">604</span><span class="MXMLDefault_Text">&quot; height=&quot;</span><span class="MXMLString">478</span><span class="MXMLDefault_Text">&quot;</span><span class="MXMLComponent_Tag">&gt;</span>
     
<span class="MXMLComponent_Tag">&lt;mx:TitleWindow</span><span class="MXMLDefault_Text"> xmlns:mx=&quot;</span><span class="MXMLString">http://www.adobe.com/2006/mxml</span><span class="MXMLDefault_Text">&quot; layout=&quot;</span><span class="MXMLString">absolute</span><span class="MXMLDefault_Text">&quot; width=&quot;</span><span class="MXMLString">604</span><span class="MXMLDefault_Text">&quot; height=&quot;</span><span class="MXMLString">360</span><span class="MXMLDefault_Text">&quot; title=&quot;</span><span class="MXMLString">Lobby</span><span class="MXMLDefault_Text">&quot; borderColor=&quot;</span><span class="MXMLString">#AD3333</span><span class="MXMLDefault_Text">&quot; color=&quot;</span><span class="MXMLString">#FFFFFF</span><span class="MXMLDefault_Text">&quot; fontSize=&quot;</span><span class="MXMLString">12</span><span class="MXMLDefault_Text">&quot; showCloseButton=&quot;</span><span class="MXMLString">false</span><span class="MXMLDefault_Text">&quot; alpha=&quot;</span><span class="MXMLString">1.0</span><span class="MXMLDefault_Text">&quot; backgroundAlpha=&quot;</span><span class="MXMLString">0.0</span><span class="MXMLDefault_Text">&quot; borderAlpha=&quot;</span><span class="MXMLString">1</span><span class="MXMLDefault_Text">&quot; backgroundColor=&quot;</span><span class="MXMLString">#540808</span><span class="MXMLDefault_Text">&quot; defaultButton=&quot;</span><span class="MXMLString">{</span><span class="ActionScriptDefault_Text">joinButton</span><span class="MXMLString">}</span><span class="MXMLDefault_Text">&quot; creationComplete=&quot;</span><span class="ActionScriptDefault_Text">setupLobby</span><span class="ActionScriptBracket/Brace">()</span><span class="MXMLDefault_Text">&quot; shadowDirection=&quot;</span><span class="MXMLString">right</span><span class="MXMLDefault_Text">&quot;</span><span class="MXMLComponent_Tag">&gt;</span>

    <span class="MXMLSpecial_Tag">&lt;mx:Script&gt;</span>
        <span class="ActionScriptOperator">&lt;!</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">CDATA</span><span class="ActionScriptBracket/Brace">[</span>
            <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span>.<span class="ActionScriptDefault_Text">cubeia</span>.<span class="ActionScriptDefault_Text">firebase</span>.<span class="ActionScriptDefault_Text">util</span>.<span class="ActionScriptDefault_Text">ParameterUtil</span>;
            <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span>.<span class="ActionScriptDefault_Text">cubeia</span>.<span class="ActionScriptDefault_Text">firebase</span>.<span class="ActionScriptDefault_Text">io</span>.<span class="ActionScriptDefault_Text">protocol</span>.<span class="ActionScriptDefault_Text">Param</span>;
            <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span>.<span class="ActionScriptDefault_Text">cubeia</span>.<span class="ActionScriptDefault_Text">firebase</span>.<span class="ActionScriptDefault_Text">io</span>.<span class="ActionScriptDefault_Text">protocol</span>.<span class="ActionScriptDefault_Text">JoinResponsePacket</span>;
            <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span>.<span class="ActionScriptDefault_Text">cubeia</span>.<span class="ActionScriptDefault_Text">firebase</span>.<span class="ActionScriptDefault_Text">io</span>.<span class="ActionScriptDefault_Text">ProtocolObject</span>;
            <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span>.<span class="ActionScriptDefault_Text">cubeia</span>.<span class="ActionScriptDefault_Text">firebase</span>.<span class="ActionScriptDefault_Text">model</span>.<span class="ActionScriptDefault_Text">LobbyDataItem</span>;
            <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">collections</span>.<span class="ActionScriptDefault_Text">ArrayCollection</span>;
            <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span>.<span class="ActionScriptDefault_Text">cubeia</span>.<span class="ActionScriptDefault_Text">firebase</span>.<span class="ActionScriptDefault_Text">events</span>.<span class="ActionScriptDefault_Text">PacketEvent</span>;
            <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span>.<span class="ActionScriptDefault_Text">cubeia</span>.<span class="ActionScriptDefault_Text">firebase</span>.<span class="ActionScriptDefault_Text">events</span>.<span class="ActionScriptDefault_Text">LobbyEvent</span>;
            <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span>.<span class="ActionScriptDefault_Text">cubeia</span>.<span class="ActionScriptDefault_Text">firebase</span>.<span class="ActionScriptDefault_Text">io</span>.<span class="ActionScriptDefault_Text">protocol</span>.<span class="ActionScriptDefault_Text">JoinRequestPacket</span>;
            <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span>.<span class="ActionScriptDefault_Text">cubeia</span>.<span class="ActionScriptDefault_Text">firebase</span>.<span class="ActionScriptDefault_Text">io</span>.<span class="ActionScriptDefault_Text">protocol</span>.<span class="ActionScriptDefault_Text">CreateTableRequestPacket</span>;
            <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span>.<span class="ActionScriptDefault_Text">cubeia</span>.<span class="ActionScriptDefault_Text">firebase</span>.<span class="ActionScriptDefault_Text">io</span>.<span class="ActionScriptDefault_Text">protocol</span>.<span class="ActionScriptDefault_Text">Param</span>;
            <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">managers</span>.<span class="ActionScriptDefault_Text">PopUpManager</span>;
            
            <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptMetadata">Bindable</span><span class="ActionScriptBracket/Brace">]</span>
            <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_joinPending</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
            
            <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptMetadata">Bindable</span><span class="ActionScriptBracket/Brace">]</span>
            <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">lobbyData</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ArrayCollection</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ArrayCollection</span><span class="ActionScriptBracket/Brace">()</span>;
            
            <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">setupLobby</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">lobbySubscribe</span><span class="ActionScriptBracket/Brace">(</span>236<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">lobbySubscribe</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">gameId</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// setup lobby event listeners, one for each type
</span>                <span class="ActionScriptDefault_Text">KalahaRealClient</span>.<span class="ActionScriptDefault_Text">firebaseClient</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">LobbyEvent</span>.<span class="ActionScriptDefault_Text">TABLE_ADDED</span>, <span class="ActionScriptDefault_Text">onTableAdded</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">KalahaRealClient</span>.<span class="ActionScriptDefault_Text">firebaseClient</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">LobbyEvent</span>.<span class="ActionScriptDefault_Text">TABLE_UPDATED</span>, <span class="ActionScriptDefault_Text">onTableUpdated</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">KalahaRealClient</span>.<span class="ActionScriptDefault_Text">firebaseClient</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">LobbyEvent</span>.<span class="ActionScriptDefault_Text">TABLE_REMOVED</span>, <span class="ActionScriptDefault_Text">onTableRemoved</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptComment">// subscribe to lobby events for gameId
</span>                <span class="ActionScriptDefault_Text">KalahaRealClient</span>.<span class="ActionScriptDefault_Text">firebaseClient</span>.<span class="ActionScriptDefault_Text">lobbySubscribe</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">gameId</span>, <span class="ActionScriptString">&quot;/&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">lobbyUnsubscribe</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">gameId</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// remove event listeners
</span>                <span class="ActionScriptDefault_Text">KalahaRealClient</span>.<span class="ActionScriptDefault_Text">firebaseClient</span>.<span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">LobbyEvent</span>.<span class="ActionScriptDefault_Text">TABLE_ADDED</span>, <span class="ActionScriptDefault_Text">onTableAdded</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">KalahaRealClient</span>.<span class="ActionScriptDefault_Text">firebaseClient</span>.<span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">LobbyEvent</span>.<span class="ActionScriptDefault_Text">TABLE_UPDATED</span>, <span class="ActionScriptDefault_Text">onTableUpdated</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">KalahaRealClient</span>.<span class="ActionScriptDefault_Text">firebaseClient</span>.<span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">LobbyEvent</span>.<span class="ActionScriptDefault_Text">TABLE_REMOVED</span>, <span class="ActionScriptDefault_Text">onTableRemoved</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptComment">// Unsubscribe 
</span>                <span class="ActionScriptDefault_Text">KalahaRealClient</span>.<span class="ActionScriptDefault_Text">firebaseClient</span>.<span class="ActionScriptDefault_Text">lobbyUnsubscribe</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">gameId</span>, <span class="ActionScriptString">&quot;/&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">onTableAdded</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lobbyEvent</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">LobbyEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// a table was added to the lobby
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">lobbyDataItem</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">LobbyDataItem</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">lobbyEvent</span>.<span class="ActionScriptDefault_Text">lobbyDataItem</span>;

                <span class="ActionScriptComment">// Create a dynamic object to hold table info
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">item</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptBracket/Brace">()</span>;
                
                <span class="ActionScriptComment">// set table info
</span>                <span class="ActionScriptDefault_Text">item</span>.<span class="ActionScriptDefault_Text">name</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">lobbyDataItem</span>.<span class="ActionScriptDefault_Text">name</span>;
                <span class="ActionScriptDefault_Text">item</span>.<span class="ActionScriptDefault_Text">capacity</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">lobbyDataItem</span>.<span class="ActionScriptDefault_Text">capacity</span>;
                <span class="ActionScriptDefault_Text">item</span>.<span class="ActionScriptDefault_Text">seated</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">lobbyDataItem</span>.<span class="ActionScriptDefault_Text">seated</span>;
                <span class="ActionScriptDefault_Text">item</span>.<span class="ActionScriptDefault_Text">tableId</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">lobbyDataItem</span>.<span class="ActionScriptDefault_Text">tableid</span>;
                <span class="ActionScriptDefault_Text">item</span>.<span class="ActionScriptDefault_Text">address</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">lobbyDataItem</span>.<span class="ActionScriptDefault_Text">address</span>;
                
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">gameId</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">lobbyDataItem</span>.<span class="ActionScriptDefault_Text">getValue</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;gameId&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptComment">// add to lobby data collection
</span>                <span class="ActionScriptDefault_Text">lobbyData</span>.<span class="ActionScriptDefault_Text">addItem</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">item</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">onTableUpdated</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lobbyEvent</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">LobbyEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// a table has been updated in the lobby
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">lobbyDataItem</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">LobbyDataItem</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">lobbyEvent</span>.<span class="ActionScriptDefault_Text">lobbyDataItem</span>;
                
                <span class="ActionScriptComment">// locate table
</span>                <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">item</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">lobbyData</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span> 
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">item</span>.<span class="ActionScriptDefault_Text">tableId</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">lobbyEvent</span>.<span class="ActionScriptDefault_Text">tableId</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptComment">// we have a match, update seated count
</span>                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">oldSeated</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">item</span>.<span class="ActionScriptDefault_Text">seated</span>;
                        <span class="ActionScriptDefault_Text">item</span>.<span class="ActionScriptDefault_Text">seated</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">lobbyDataItem</span>.<span class="ActionScriptDefault_Text">seated</span>;
                        <span class="ActionScriptComment">// Tell all views that this item has been updated
</span>                        <span class="ActionScriptDefault_Text">lobbyData</span>.<span class="ActionScriptDefault_Text">itemUpdated</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">item</span>, <span class="ActionScriptString">&quot;seated&quot;</span>, <span class="ActionScriptDefault_Text">oldSeated</span>, <span class="ActionScriptDefault_Text">lobbyDataItem</span>.<span class="ActionScriptDefault_Text">seated</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptReserved">break</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
             <span class="ActionScriptBracket/Brace">}</span>                        
            
            <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">onTableRemoved</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lobbyEvent</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">LobbyEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// find table and remove it from the list
</span>                <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">item</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">lobbyData</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span> 
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">item</span>.<span class="ActionScriptDefault_Text">tableId</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">lobbyEvent</span>.<span class="ActionScriptDefault_Text">tableId</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">lobbyData</span>.<span class="ActionScriptDefault_Text">removeItemAt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lobbyData</span>.<span class="ActionScriptDefault_Text">getItemIndex</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">item</span><span class="ActionScriptBracket/Brace">))</span>;
                        <span class="ActionScriptReserved">break</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">// Called when a table join has been selected in the lobby grid 
</span>            <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">onTableSelected</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">lobbyGrid</span>.<span class="ActionScriptDefault_Text">selectedItem</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">_joinPending</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
                    
                    <span class="ActionScriptComment">// setup packet data handler 
</span>                    <span class="ActionScriptDefault_Text">KalahaRealClient</span>.<span class="ActionScriptDefault_Text">firebaseClient</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">PacketEvent</span>.<span class="ActionScriptDefault_Text">PACKET_RECEIVED</span>, <span class="ActionScriptDefault_Text">onPacketReceived</span><span class="ActionScriptBracket/Brace">)</span>;

                    <span class="ActionScriptComment">// create a join request packet
</span>                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">joinRequestPacket</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">JoinRequestPacket</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">JoinRequestPacket</span><span class="ActionScriptBracket/Brace">()</span>;
                    <span class="ActionScriptComment">// tell server to pick a random seat
</span>                    <span class="ActionScriptDefault_Text">joinRequestPacket</span>.<span class="ActionScriptDefault_Text">seat</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span>1;
                    <span class="ActionScriptComment">// table id
</span>                    <span class="ActionScriptDefault_Text">joinRequestPacket</span>.<span class="ActionScriptDefault_Text">tableid</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">lobbyGrid</span>.<span class="ActionScriptDefault_Text">selectedItem</span>.<span class="ActionScriptDefault_Text">tableId</span>;
                    <span class="ActionScriptComment">// send the packet to the game server
</span>                    <span class="ActionScriptDefault_Text">KalahaRealClient</span>.<span class="ActionScriptDefault_Text">firebaseClient</span>.<span class="ActionScriptDefault_Text">send</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">joinRequestPacket</span><span class="ActionScriptBracket/Brace">)</span>; 
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">onPacketReceived</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">packetEvent</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">PacketEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// packet received, inspect it
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">protocolObject</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ProtocolObject</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">packetEvent</span>.<span class="ActionScriptDefault_Text">getObject</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">protocolObject</span>.<span class="ActionScriptDefault_Text">classId</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">JoinResponsePacket</span>.<span class="ActionScriptDefault_Text">CLASSID</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">// player has joined a table, remove packet listener and unsubscribe
</span>                    <span class="ActionScriptDefault_Text">KalahaRealClient</span>.<span class="ActionScriptDefault_Text">firebaseClient</span>.<span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">PacketEvent</span>.<span class="ActionScriptDefault_Text">PACKET_RECEIVED</span>, <span class="ActionScriptDefault_Text">onPacketReceived</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">lobbyUnsubscribe</span><span class="ActionScriptBracket/Brace">(</span>236<span class="ActionScriptBracket/Brace">)</span>; 
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">onTableRequested</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
            <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">onChallenge</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">requestTablePacket</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">CreateTableRequestPacket</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">CreateTableRequestPacket</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptDefault_Text">requestTablePacket</span>.<span class="ActionScriptDefault_Text">gameid</span> <span class="ActionScriptOperator">=</span> 236;
                <span class="ActionScriptDefault_Text">requestTablePacket</span>.<span class="ActionScriptDefault_Text">seats</span> <span class="ActionScriptOperator">=</span> 2;
                <span class="ActionScriptDefault_Text">requestTablePacket</span>.<span class="ActionScriptDefault_Text">seq</span> <span class="ActionScriptOperator">=</span> 1;
                <span class="ActionScriptDefault_Text">requestTablePacket</span>.<span class="ActionScriptDefault_Text">invitees</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">param</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Param</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ParameterUtil</span>.<span class="ActionScriptDefault_Text">makeIntegerParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;opponent&quot;</span>, <span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">opponentId</span>.<span class="ActionScriptDefault_Text">text</span><span class="ActionScriptBracket/Brace">))</span>;
                <span class="ActionScriptDefault_Text">requestTablePacket</span>.<span class="ActionScriptDefault_Text">params</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">param</span><span class="ActionScriptBracket/Brace">]</span>;
                
                <span class="ActionScriptDefault_Text">KalahaRealClient</span>.<span class="ActionScriptDefault_Text">firebaseClient</span>.<span class="ActionScriptDefault_Text">send</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">requestTablePacket</span><span class="ActionScriptBracket/Brace">)</span>;                                                                
            <span class="ActionScriptBracket/Brace">}</span>


            
        <span class="ActionScriptBracket/Brace">]]</span><span class="ActionScriptOperator">&gt;</span>
    <span class="MXMLSpecial_Tag">&lt;/mx:Script&gt;</span>
    
    <span class="MXMLComponent_Tag">&lt;mx:DataGrid</span><span class="MXMLDefault_Text"> id=&quot;</span><span class="MXMLString">lobbyGrid</span><span class="MXMLDefault_Text">&quot; x=&quot;</span><span class="MXMLString">0</span><span class="MXMLDefault_Text">&quot; y=&quot;</span><span class="MXMLString">0</span><span class="MXMLDefault_Text">&quot; width=&quot;</span><span class="MXMLString">100%</span><span class="MXMLDefault_Text">&quot; height=&quot;</span><span class="MXMLString">100%</span><span class="MXMLDefault_Text">&quot; dataProvider=&quot;</span><span class="MXMLString">{</span><span class="ActionScriptDefault_Text">lobbyData</span><span class="MXMLString">}</span><span class="MXMLDefault_Text">&quot; doubleClickEnabled=&quot;</span><span class="MXMLString">true</span><span class="MXMLDefault_Text">&quot; itemDoubleClick=&quot;</span><span class="ActionScriptDefault_Text">onTableSelected</span><span class="ActionScriptBracket/Brace">()</span><span class="MXMLDefault_Text">&quot; tabIndex=&quot;</span><span class="MXMLString">1</span><span class="MXMLDefault_Text">&quot; color=&quot;</span><span class="MXMLString">#F2E8E8</span><span class="MXMLDefault_Text">&quot; headerColors=&quot;</span><span class="MXMLString">[#AD3333, #803333]</span><span class="MXMLDefault_Text">&quot; alternatingItemColors=&quot;</span><span class="MXMLString">[#AD3333, #803333]</span><span class="MXMLDefault_Text">&quot; editable=&quot;</span><span class="MXMLString">false</span><span class="MXMLDefault_Text">&quot; themeColor=&quot;</span><span class="MXMLString">#F17612</span><span class="MXMLDefault_Text">&quot; horizontalGridLineColor=&quot;</span><span class="MXMLString">#000000</span><span class="MXMLDefault_Text">&quot; horizontalGridLines=&quot;</span><span class="MXMLString">true</span><span class="MXMLDefault_Text">&quot; verticalGridLineColor=&quot;</span><span class="MXMLString">#000000</span><span class="MXMLDefault_Text">&quot; borderColor=&quot;</span><span class="MXMLString">#000000</span><span class="MXMLDefault_Text">&quot;</span><span class="MXMLComponent_Tag">&gt;</span>
        <span class="MXMLComponent_Tag">&lt;mx:columns&gt;</span>
            <span class="MXMLComponent_Tag">&lt;mx:DataGridColumn</span><span class="MXMLDefault_Text"> headerText=&quot;</span><span class="MXMLString">Name</span><span class="MXMLDefault_Text">&quot; dataField=&quot;</span><span class="MXMLString">name</span><span class="MXMLDefault_Text">&quot;</span><span class="MXMLComponent_Tag">/&gt;</span>
            <span class="MXMLComponent_Tag">&lt;mx:DataGridColumn</span><span class="MXMLDefault_Text"> headerText=&quot;</span><span class="MXMLString">Capacity</span><span class="MXMLDefault_Text">&quot; dataField=&quot;</span><span class="MXMLString">capacity</span><span class="MXMLDefault_Text">&quot;</span><span class="MXMLComponent_Tag">/&gt;</span>
            <span class="MXMLComponent_Tag">&lt;mx:DataGridColumn</span><span class="MXMLDefault_Text"> headerText=&quot;</span><span class="MXMLString">Seated</span><span class="MXMLDefault_Text">&quot; dataField=&quot;</span><span class="MXMLString">seated</span><span class="MXMLDefault_Text">&quot;</span><span class="MXMLComponent_Tag">/&gt;</span> 
        <span class="MXMLComponent_Tag">&lt;/mx:columns&gt;</span>
    <span class="MXMLComponent_Tag">&lt;/mx:DataGrid&gt;</span>

<span class="MXMLComponent_Tag">&lt;/mx:TitleWindow&gt;</span>
    <span class="MXMLComponent_Tag">&lt;mx:Button</span><span class="MXMLDefault_Text"> x=&quot;</span><span class="MXMLString">277.5</span><span class="MXMLDefault_Text">&quot; y=&quot;</span><span class="MXMLString">384</span><span class="MXMLDefault_Text">&quot; label=&quot;</span><span class="MXMLString">Join</span><span class="MXMLDefault_Text">&quot; id=&quot;</span><span class="MXMLString">joinButton</span><span class="MXMLDefault_Text">&quot; click=&quot;</span><span class="ActionScriptDefault_Text">onTableSelected</span><span class="ActionScriptBracket/Brace">()</span><span class="MXMLDefault_Text">&quot; enabled=&quot;</span><span class="MXMLString">{</span><span class="ActionScriptDefault_Text">lobbyGrid</span>.<span class="ActionScriptDefault_Text">selectedItem</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="MXMLString">}</span><span class="MXMLDefault_Text">&quot; tabIndex=&quot;</span><span class="MXMLString">2</span><span class="MXMLDefault_Text">&quot; themeColor=&quot;</span><span class="MXMLString">#AD3333</span><span class="MXMLDefault_Text">&quot; color=&quot;</span><span class="MXMLString">#FFFFFF</span><span class="MXMLDefault_Text">&quot; fillAlphas=&quot;</span><span class="MXMLString">[1.0, 1.0]</span><span class="MXMLDefault_Text">&quot; fillColors=&quot;</span><span class="MXMLString">[#AD3333, #460A0A]</span><span class="MXMLDefault_Text">&quot;</span><span class="MXMLComponent_Tag">/&gt;</span>
    <span class="MXMLComponent_Tag">&lt;mx:Button</span><span class="MXMLDefault_Text"> x=&quot;</span><span class="MXMLString">291</span><span class="MXMLDefault_Text">&quot; y=&quot;</span><span class="MXMLString">414</span><span class="MXMLDefault_Text">&quot; label=&quot;</span><span class="MXMLString">Challenge playerId</span><span class="MXMLDefault_Text">&quot; click=&quot;</span><span class="ActionScriptDefault_Text">onChallenge</span><span class="ActionScriptBracket/Brace">()</span><span class="MXMLDefault_Text">&quot;</span><span class="MXMLComponent_Tag">/&gt;</span>
    <span class="MXMLComponent_Tag">&lt;mx:TextInput</span><span class="MXMLDefault_Text"> id = </span>&quot;<span class="MXMLString">gameId</span><span class="MXMLDefault_Text">&quot; x=&quot;</span><span class="MXMLString">123</span><span class="MXMLDefault_Text">&quot; y=&quot;</span><span class="MXMLString">446</span><span class="MXMLDefault_Text">&quot;</span><span class="MXMLComponent_Tag">/&gt;</span>
    <span class="MXMLComponent_Tag">&lt;mx:TextInput</span><span class="MXMLDefault_Text"> id = </span>&quot;<span class="MXMLString">opponentId</span><span class="MXMLDefault_Text">&quot; x=&quot;</span><span class="MXMLString">123</span><span class="MXMLDefault_Text">&quot; y=&quot;</span><span class="MXMLString">414</span><span class="MXMLDefault_Text">&quot;</span><span class="MXMLComponent_Tag">/&gt;</span>
    <span class="MXMLComponent_Tag">&lt;mx:Button</span><span class="MXMLDefault_Text"> x=&quot;</span><span class="MXMLString">291</span><span class="MXMLDefault_Text">&quot; y=&quot;</span><span class="MXMLString">446</span><span class="MXMLDefault_Text">&quot; label=&quot;</span><span class="MXMLString">Request table for gameId</span><span class="MXMLDefault_Text">&quot; click=&quot;</span><span class="ActionScriptDefault_Text">onTableRequested</span><span class="ActionScriptBracket/Brace">()</span><span class="MXMLDefault_Text">&quot;</span><span class="MXMLComponent_Tag">/&gt;</span>
<span class="MXMLComponent_Tag">&lt;/mx:Canvas&gt;</span></pre></body>
</html>
