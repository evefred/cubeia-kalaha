<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<!-- script type="text/javascript" src="js/json2.js"></script -->
<script type="text/javascript" src="js/fb/firebase-protocol-1.8-CE-SNAPSHOT.js"></script>
<script type="text/javascript" src="js/fb/firebase-js-api-1.8-CE-SNAPSHOT.js"></script>
<script type="text/javascript" src="js/org/cometd/cometd-namespace.js"></script>
<script type="text/javascript" src="js/org/cometd/CallbackPollingTransport.js"></script>
<script type="text/javascript" src="js/org/cometd/LongPollingTransport.js"></script>
<script type="text/javascript" src="js/org/cometd/WebSocketTransport.js"></script>
<script type="text/javascript" src="js/org/cometd/cometd-header.js"></script>
<script type="text/javascript" src="js/org/cometd/cometd-json.js"></script>
<script type="text/javascript" src="js/org/cometd/RequestTransport.js"></script>
<script type="text/javascript" src="js/org/cometd/Transport.js"></script>
<script type="text/javascript" src="js/org/cometd/TransportRegistry.js"></script>
<script type="text/javascript" src="js/org/cometd/Utils.js"></script>
<script type="text/javascript" src="js/org/cometd/Cometd.js"></script>
<!-- script type="text/javascript" src="js/fb/firebase-jquery-cometd.js"></script -->
<script type="text/javascript" src="js/jquery-1.7.1.js"></script>
<script type="text/javascript" src="js/jquery.cometd.js"></script>

<script type="text/javascript">

var useCometd = true;

var connector;
var hostUrl = "localhost";
var hostPort = 8080;
var loggedId = false;

function packetCallback(protocolObject) {
	console.log("packet: " + protocolObject);
}

function lobbyCallback(protocolObject) {
	console.log("lobby: " + protocolObject);
}

function loginCallback(status, pid, nick) {
	console.log("login: " + status + "; " + nick + " (" + pid + ")");
	if(status == "OK") {
		loggedId = true;
		$("#status").hide("slow", function() {
			$("#status").text("You ARE logged in!");
			$("#status").show("slow");
		});
	} 
}

function statusCallback(statusCode, msg) {
	console.log("status: " + statusCode + "; msg: " + msg);
	if(statusCode == 7 && loggedId) {
		loggedId = false;
		$("#status").hide("slow", function() {
			connect();
			$("#status").text("You are NOT logged in!");
			$("#status").show("slow");
		});
	}
}

function connect() {
	console.log("creating connector; host= " + hostUrl + ":" + hostPort);
	connector = new FIREBASE.Connector(packetCallback, lobbyCallback, loginCallback, statusCallback);
	if(useCometd) {
		connector.connect("FIREBASE.CometdAdapter", hostUrl, hostPort, "/cometd", false, function() { return $.cometd });
	} else {
		connector.connect("FIREBASE.WebSocketAdapter", hostUrl, hostPort, "/socket");
	}
}

//function logout() {
//	var logoutRequest=new FB_PROTOCOL.LogoutPacket();
//	logoutRequest.leaveTables=true;
//	connector.sendProtocolObject(logoutRequest);
//}

$(document).ready(function() {
	setupUIElements();
	connect();
});

function setupUIElements() {
	
	$("#butt").click(function(event) {
		event.preventDefault();
		
		if(loggedId) {
			console.log("logging out");
			connector.logout();
		} else {
			console.log("logging in with user 'larsan' / '666'");
			connector.login("larsan", "666", 0);
		}
				

		
	});
}

</script>
<title>Insert title here</title>
</head>
<body>

<div id="status">You are NOT logged in!</div>

<button id="butt">Switch!</button>

</body>
</html>